from SAF.features import generator
import numpy as np


def test_generate_binary_features(cif_ThGe):
    actual_binary_combined_data, actual_uni_combined_data = (
        generator.generate_binary_features(cif_ThGe)
    )
    assert actual_binary_combined_data == {
        "Entry": "ThGe",
        "Formula": "ThGe",
        "Structure": "NaCl",
        "A": "Ge",
        "B": "Th",
        "INT_distAA": 4.275,
        "INT_distBB": 4.275,
        "INT_distAB": 3.023,
        "INT_Asize": 1.225,
        "INT_Bsize": 1.798,
        "INT_Asize_by_Bsize": 0.6813125695216908,
        "INT_distAA_by2_byAsize": 1.7448979591836735,
        "INT_distBB_by2_byBsize": 1.188820912124583,
        "INT_distAB_by2_byAsizebyBsize": 1.0,
        "INT_Asize_ref": np.float64(2.1375),
        "INT_Bsize_ref": np.float64(0.8854999999999997),
        "INT_percent_diff_A_by_100": np.float64(0.7448979591836735),
        "INT_percent_diff_B_by_100": np.float64(-0.5075083426028922),
        "INT_distAA_minus_ref_diff": np.float64(0.0),
        "INT_distBB_minus_ref_diff": np.float64(0.585730994152047),
        "INT_distAB_minus_ref_diff": np.float64(1.4690347662919703e-16),
        "INT_R_factor": np.float64(0.8124376874075364),
        "INT_UNI_shortest_homoatomic_dist": 4.275,
        "INT_UNI_shortest_heteroatomic_dist": 3.023,
        "INT_UNI_shortest_homoatomic_dist_by_2_by_atom_size": 1.7448979591836735,
        "INT_UNI_shortest_heteroatomic_dist_by_sum_of_atom_sizes": 1.0,
        "INT_UNI_shortest_homoatomic_dist_by_2_by_refined_atom_size": np.float64(1.0),
        "INT_UNI_shortest_heteroatomic_dist_by_sum_of_refined_atom_sizes": np.float64(
            1.0000000000000002
        ),
        "INT_UNI_highest_refined_percent_diff_abs": np.float64(0.7448979591836735),
        "INT_UNI_lowest_refined_percent_diff_abs": np.float64(0.5075083426028922),
        "INT_UNI_refined_packing_efficiency": np.float64(0.79303),
        "WYK_A_lowest_wyckoff": 4,
        "WYK_B_lowest_wyckoff": 4,
        "WYK_identical_lowest_wyckoff_count": 2,
        "WYK_A_sites_total": 1,
        "WYK_B_sites_total": 1,
        "WYK_A_multiplicity_total": 4,
        "WYK_B_multiplicity_total": 4,
        "ENV_A_shortest_dist_count": np.int64(6),
        "ENV_B_shortest_dist_count": np.int64(6),
        "ENV_A_avg_shortest_dist_count": np.float64(6.0),
        "ENV_B_avg_shortest_dist_count": np.float64(6.0),
        "ENV_A_shortest_tol_dist_count": 6,
        "ENV_B_shortest_tol_dist_count": 6,
        "ENV_A_avg_shortest_dist_within_tol_count": 6.0,
        "ENV_B_avg_shortest_dist_within_tol_count": 6.0,
        "ENV_A_second_by_first_shortest_dist": np.float64(1.414158121071783),
        "ENV_B_second_by_first_shortest_dist": np.float64(1.414158121071783),
        "ENV_A_avg_second_by_first_shortest_dist": np.float64(1.414158121071783),
        "ENV_B_avg_second_by_first_shortest_dist": np.float64(1.414158121071783),
        "ENV_A_second_shortest_dist_count": np.int64(12),
        "ENV_B_second_shortest_dist_count": np.int64(12),
        "ENV_A_avg_second_shortest_dist_count": np.float64(12.0),
        "ENV_B_avg_second_shortest_dist_count": np.float64(12.0),
        "ENV_A_homoatomic_dist_by_shortest_dist": 1.414158121071783,
        "ENV_B_homoatomic_dist_by_shortest_dist": 1.414158121071783,
        "ENV_A_avg_homoatomic_dist_by_shortest_dist": 1.414158121071783,
        "ENV_B_avg_homoatomic_dist_by_shortest_dist": 1.414158121071783,
        "ENV_A_count_at_A_shortest_dist": 0,
        "ENV_A_count_at_B_shortest_dist": 6,
        "ENV_A_avg_count_at_A_shortest_dist": 0.0,
        "ENV_A_avg_count_at_B_shortest_dist": 6.0,
        "ENV_B_count_at_A_shortest_dist": 6,
        "ENV_B_count_at_B_shortest_dist": 0,
        "ENV_B_avg_count_at_A_shortest_dist": 6.0,
        "ENV_B_avg_count_at_B_shortest_dist": 0.0,
        "CN_AVG_coordination_number": 10.5,
        "CN_AVG_A_atom_count": 3.0,
        "CN_AVG_B_atom_count": 7.5,
        "CN_AVG_polyhedron_volume": 92.08575,
        "CN_AVG_central_atom_to_center_of_mass_dist": np.float64(0.0),
        "CN_AVG_number_of_edges": 18.75,
        "CN_AVG_number_of_faces": 12.5,
        "CN_AVG_shortest_distance_to_face": np.float64(2.28575),
        "CN_AVG_shortest_distance_to_edge": np.float64(2.469875),
        "CN_AVG_volume_of_inscribed_sphere": np.float64(64.742875),
        "CN_AVG_packing_efficiency": np.float64(0.654125),
        "CN_MIN_coordination_number": 6.0,
        "CN_MIN_A_atom_count": 3.0,
        "CN_MIN_B_atom_count": 3.0,
        "CN_MIN_polyhedron_volume": 36.834,
        "CN_MIN_central_atom_to_center_of_mass_dist": np.float64(0.0),
        "CN_MIN_number_of_edges": 12.0,
        "CN_MIN_number_of_faces": 8.0,
        "CN_MIN_shortest_distance_to_face": np.float64(1.745),
        "CN_MIN_shortest_distance_to_edge": np.float64(2.138),
        "CN_MIN_volume_of_inscribed_sphere": np.float64(22.27),
        "CN_MIN_packing_efficiency": np.float64(0.605),
        "CN_MAX_coordination_number": 6.0,
        "CN_MAX_A_atom_count": 3.0,
        "CN_MAX_B_atom_count": 9.0,
        "CN_MAX_polyhedron_volume": 110.503,
        "CN_MAX_central_atom_to_center_of_mass_dist": np.float64(0.0),
        "CN_MAX_number_of_edges": 21.0,
        "CN_MAX_number_of_faces": 14.0,
        "CN_MAX_shortest_distance_to_face": np.float64(2.466),
        "CN_MAX_shortest_distance_to_edge": np.float64(2.5805),
        "CN_MAX_volume_of_inscribed_sphere": np.float64(78.90050000000001),
        "CN_MAX_packing_efficiency": np.float64(0.6705),
    }
    assert actual_uni_combined_data == {
        "Entry": "ThGe",
        "Formula": "ThGe",
        "INT_UNI_shortest_homoatomic_dist": 4.275,
        "INT_UNI_shortest_heteroatomic_dist": 3.023,
        "INT_UNI_shortest_homoatomic_dist_by_2_by_atom_size": 1.7448979591836735,
        "INT_UNI_shortest_heteroatomic_dist_by_sum_of_atom_sizes": 1.0,
        "INT_UNI_shortest_homoatomic_dist_by_2_by_refined_atom_size": np.float64(1.0),
        "INT_UNI_shortest_heteroatomic_dist_by_sum_of_refined_atom_sizes": np.float64(
            1.0000000000000002
        ),
        "INT_UNI_highest_refined_percent_diff_abs": np.float64(0.7448979591836735),
        "INT_UNI_lowest_refined_percent_diff_abs": np.float64(0.5075083426028922),
        "INT_UNI_refined_packing_efficiency": np.float64(0.79303),
        "UNI_WYK_lowest_wyckoff": 4,
        "CN_AVG_coordination_number": 10.5,
        "CN_AVG_A_atom_count": 3.0,
        "CN_AVG_B_atom_count": 7.5,
        "CN_AVG_polyhedron_volume": 92.08575,
        "CN_AVG_central_atom_to_center_of_mass_dist": np.float64(0.0),
        "CN_AVG_number_of_edges": 18.75,
        "CN_AVG_number_of_faces": 12.5,
        "CN_AVG_shortest_distance_to_face": np.float64(2.28575),
        "CN_AVG_shortest_distance_to_edge": np.float64(2.469875),
        "CN_AVG_volume_of_inscribed_sphere": np.float64(64.742875),
        "CN_AVG_packing_efficiency": np.float64(0.654125),
        "CN_MIN_coordination_number": 6.0,
        "CN_MIN_A_atom_count": 3.0,
        "CN_MIN_B_atom_count": 3.0,
        "CN_MIN_polyhedron_volume": 36.834,
        "CN_MIN_central_atom_to_center_of_mass_dist": np.float64(0.0),
        "CN_MIN_number_of_edges": 12.0,
        "CN_MIN_number_of_faces": 8.0,
        "CN_MIN_shortest_distance_to_face": np.float64(1.745),
        "CN_MIN_shortest_distance_to_edge": np.float64(2.138),
        "CN_MIN_volume_of_inscribed_sphere": np.float64(22.27),
        "CN_MIN_packing_efficiency": np.float64(0.605),
        "CN_MAX_coordination_number": 6.0,
        "CN_MAX_A_atom_count": 3.0,
        "CN_MAX_B_atom_count": 9.0,
        "CN_MAX_polyhedron_volume": 110.503,
        "CN_MAX_central_atom_to_center_of_mass_dist": np.float64(0.0),
        "CN_MAX_number_of_edges": 21.0,
        "CN_MAX_number_of_faces": 14.0,
        "CN_MAX_shortest_distance_to_face": np.float64(2.466),
        "CN_MAX_shortest_distance_to_edge": np.float64(2.5805),
        "CN_MAX_volume_of_inscribed_sphere": np.float64(78.90050000000001),
        "CN_MAX_packing_efficiency": np.float64(0.6705),
    }
